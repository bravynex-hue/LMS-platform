services:
  # MongoDB Service (for local development)
  mongo:
    image: mongo:6.0
    container_name: lms_mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db
    networks:
      - lms_network

  # Server Service (Node.js backend)
  server:
    build: 
      context: ./server
    container_name: lms_server
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
      - MONGO_URI=mongodb://mongo:27017/lms_db # Use internal docker network alias
      - NODE_ENV=development
      # Add other necessary env vars here or use env_file
    env_file:
      - ./server/.env # Load secrets from server/.env if exists
    depends_on:
      - mongo
    networks:
      - lms_network

  # Client Service (React + Nginx)
  client:
    build:
      context: ./client
      args:
        # The URL the browser should use to reach the backend
        VITE_API_BASE_URL: http://localhost:5000 
    container_name: lms_client
    ports:
      - "80:80"  # Map container port 80 to host port 80 (or 3000 if preferred)
    depends_on:
      - server
    networks:
      - lms_network

networks:
  lms_network:
    driver: bridge

volumes:
  mongo_data:
